{% extends 'main.html' %}

{% block title %}My Inbox{% endblock title %}

{% block content %}
<div class="container py-5">
    <header class="mb-5 border-bottom pb-3">
        <h1 class="display-4 fw-bolder text-dark">
            <i class="fas fa-inbox text-primary me-2"></i> My Inbox
            {% if unread_messages_count > 0 %}
                <span class="badge bg-danger rounded-pill fs-6 ms-2 py-2 px-3 shadow-sm">{{ unread_messages_count }} New</span>
            {% endif %}
        </h1>
        <p class="lead text-secondary">View messages and announcements received from the system administrators and staff.</p>
    </header>

    <div class="card shadow-lg border-0 rounded-4">
        <div class="card-body p-0">
            {% if messages %}
            <div class="list-group list-group-flush">
                {% for message in messages %}
                <a href="#" class="list-group-item list-group-item-action py-4 px-4 border-bottom 
                    {% if not message.is_read %}
                        bg-white fw-bold shadow-sm-hover message-unread border-start border-5 border-primary
                    {% else %}
                        list-group-item-light-hover
                    {% endif %}
                    "
                    aria-current="true"
                >
                    <div class="d-flex w-100 align-items-start justify-content-between">
                        
                        <div class="flex-grow-1 me-3">
                            <h5 class="mb-1 text-truncate 
                                {% if not message.is_read %}
                                    text-dark
                                {% else %}
                                    text-secondary
                                {% endif %}
                            ">
                                <i class="fas fa-envelope-
                                    {% if not message.is_read %}
                                        open-text text-primary
                                    {% else %}
                                        square
                                    {% endif %}
                                me-2"></i> 
                                {{ message.subject }}
                                {% if not message.is_read %}
                                    <span class="badge bg-warning text-dark ms-2">New</span>
                                {% endif %}
                            </h5>
                            <p class="mb-1 text-truncate 
                                {% if not message.is_read %}
                                    text-dark
                                {% else %}
                                    text-muted
                                {% endif %}
                            ">{{ message.body }}</p>
                            <small class="text-secondary">From: {{ message.sender.username|default:"System Admin"|title }}</small>
                        </div>

                        <small class="text-end text-muted flex-shrink-0 pt-1">
                            <i class="fas fa-clock me-1"></i> {{ message.sent_at|date:"M d, Y" }}
                            <div class="text-sm mt-1">{{ message.sent_at|date:"H:i" }}</div>
                        </small>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <div class="alert alert-info text-center p-5 m-4 border-0 rounded-3" role="alert">
                <i class="fas fa-box-open fa-3x mb-3 text-info"></i> 
                <h4 class="alert-heading">Inbox Cleared!</h4>
                <p class="mb-0 lead">Your message box is currently empty. You will receive important notifications and announcements here from staff.</p>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="mt-5 text-center">
        <a href="{% url 'booking:home' %}" class="btn btn-outline-secondary btn-lg">
            <i class="fas fa-tachometer-alt me-2"></i> Go to Dashboard
        </a>
    </div>
</div>
{% endblock content %}